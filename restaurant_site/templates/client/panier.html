{% extends 'client/base.html' %}
{% load static %}
{% load restaurant_app_extras %}

{% block title %}Votre panier{% endblock %}

{% block content %}
<main class="container mt-5 pt-5">
    <h2>Votre Panier</h2>
    {% if panier %}
    <table class="table">
        <thead>
            <tr>
                <th>Produit</th>
                <th>Quantité</th>
                <th>Prix unitaire</th>
                <th>Total</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for plat_id, item in panier.items %}
            <tr>
                <td>{{ item.nom }}</td>
                <td>
                    <form action="{% url 'modifier_quantite' plat_id=plat_id %}" method="post" class="d-flex">
                        {% csrf_token %}
                        <input type="number" name="quantite" value="{{ item.quantite }}" min="1" class="form-control me-2" style="width: 80px;">
                        <button type="submit" class="btn btn-sm btn-outline-secondary">Mettre à jour</button>
                    </form>
                </td>
                <td>{{ item.prix }} F CFA</td>
                <td>{{ item.total }} F CFA</td>
                <td>
                    <a href="{% url 'supprimer_du_panier' plat_id=plat_id %}" class="btn btn-danger btn-sm">Supprimer</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="d-flex justify-content-between align-items-center mt-4">
        <h4>Total du Panier :</h4>
        <h4><strong>{{ total }} F CFA</strong></h4>
    </div>

    <div class="mt-4 text-end">
        <a href="{% url 'validation_commande' %}" class="btn btn-primary btn-lg">Passer à la commande</a>
    </div>

    {% else %}
    <div class="alert alert-info">
        Votre panier est vide. <a href="{% url 'menu' %}">Retourner au menu</a>.
    </div>
    {% endif %}
</main>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const modeCommandeRadios = document.querySelectorAll('input[name="mode_commande"]');
        const sectionLivraison = document.getElementById('section_livraison');
        const sectionSalle = document.getElementById('section_salle');
        const methodePaiementSelect = document.getElementById('methode_paiement');

        function toggleModeCommande() {
            if (document.getElementById('livraison').checked) {
                sectionLivraison.style.display = 'block';
                sectionSalle.style.display = 'none';
                
                // Masquer l'option espèces
                methodePaiementSelect.innerHTML = `
                    <option value="">Sélectionner une méthode</option>
                    <option value="wave">Wave</option>
                    <option value="orange_money">Orange Money</option>
                    <option value="kpay">KPay</option>
                    <option value="carte_bancaire">Carte Bancaire</option>
                `;
            } else { // Service en salle
                sectionLivraison.style.display = 'none';
                sectionSalle.style.display = 'block';
                
                // Afficher l'option espèces
                methodePaiementSelect.innerHTML = `
                    <option value="">Sélectionner une méthode</option>
                    <option value="especes">Espèces (à la caisse)</option>
                    <option value="wave">Wave</option>
                    <option value="orange_money">Orange Money</option>
                    <option value="kpay">KPay</option>
                    <option value="carte_bancaire">Carte Bancaire</option>
                `;
            }
        }
        
        modeCommandeRadios.forEach(radio => radio.addEventListener('change', toggleModeCommande));
        toggleModeCommande(); // Appel initial au chargement de la page
    });
</script>
{% endblock %}